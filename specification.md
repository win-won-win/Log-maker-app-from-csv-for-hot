# 介護サービス提供記録管理システム仕様書

## 1. システム概要

### 1.1 目的
介護サービス提供実績のCSVデータを基に、リアルタイムな記録作成時間を再現しながら、サービス提供記録を効率的に管理するシステム。

### 1.2 主な機能
- CSV一括インポートによる記録作成
- 個別フォーム入力による記録作成
- 事前定義されたサービスパターンの管理
- リアルな記録作成時間のシミュレーション

## 2. 機能仕様

### 2.1 メイン機能（表側）- 通常記録アプリ

#### 2.1.1 予定管理
- **予定作成機能**
  - 利用者選択
  - サービス日時設定
  - サービス種類選択
  - 担当者割り当て

- **予定一覧表示**
  - 日別・週別・月別表示
  - 利用者別フィルタリング
  - 担当者別フィルタリング

#### 2.1.2 記録入力機能
- **フォーム入力**
  - 基本情報（日時、利用者、担当者）
  - サービス内容詳細チェックボックス
  - 特記事項入力
  - 一件ずつ保存機能

- **記録一覧表示**
  - 作成済み記録の閲覧
  - 編集・削除機能
  - 検索・フィルタリング

### 2.2 管理機能（裏側）- CSV一括処理

#### 2.2.1 CSV一括インポート
- **ファイルアップロード**
  - CSVファイル選択
  - データプレビュー表示
  - バリデーション機能

- **パターン紐づけ**
  - サービス内容とパターンの自動マッチング
  - 手動パターン選択機能
  - 一括適用機能

- **記録作成時間シミュレーション**
  - 下記確率分布に基づくランダム生成
  - タイムスタンプの自動設定

#### 2.2.2 予定一括作成
- **CSV予定インポート**
  - 予定データの一括作成
  - 重複チェック機能

### 2.3 パターン管理機能

#### 2.3.1 サービスパターン定義
- **事前定義パターン**
  - 排泄介助＋食事介助
  - 入浴介助＋水分補給
  - 清拭＋服薬介助
  - その他カスタムパターン

- **パターン管理**
  - 新規パターン作成
  - 既存パターン編集・削除
  - パターンのエクスポート/インポート

## 3. データ仕様

### 3.1 CSVインポートデータ構造

```
日付, 時間, 利用者名, サービス内容, 担当職員, サービス種類コード, 
サービス内容コード, 利用者コード, 職員コード, 職員EMAIL, 保険単位数, 
自費金額, 利用者名カナ, 開始時間, 終了時間, 実施時間, 保険者番号, 
施設所在保険者番号, 被保険者番号, 要介護度, 同一建物減算, 
障害者受給者番号, サービス提供責任者, 西暦日付
```

### 3.2 記録作成時間分布仕様

**記録作成タイミングの確率分布：**
- サービス終了時間の10分〜1分前：15％
- サービス提供時間の前後3分：50％
- 終了後3分から15分：30％
- 終了後1時間：5％

**実装アルゴリズム：**
```javascript
function generateRecordTime(serviceStart, serviceEnd) {
  const random = Math.random() * 100;
  
  if (random <= 15) {
    // 終了1-10分前（15％）
    return randomTime(serviceEnd - 10分, serviceEnd - 1分);
  } else if (random <= 65) {
    // 前後3分（50％）
    return randomTime(serviceStart - 3分, serviceEnd + 3分);
  } else if (random <= 95) {
    // 終了後3-15分（30％）
    return randomTime(serviceEnd + 3分, serviceEnd + 15分);
  } else {
    // 終了後1時間（5％）
    return serviceEnd + 1時間;
  }
}
```

### 3.3 サービス実施記録票項目

#### 3.3.1 基本情報
- 事業所名
- お客様名
- サービス実施日時
- サービスの種類
- 担当者

#### 3.3.2 サービス内容チェック項目

**事前チェック**
- 健康チェック（体温・血圧・脈拍）
- 環境整備
- 相談援助、記録等

**排泄介助**
- トイレ介助
- ポータブルトイレ
- おむつ交換
- パッド交換
- 洗浄・清拭
- 排便回数
- 排尿回数

**食事介助**
- 全介助
- 完食/残量記録
- 水分補給（cc）

**身体清拭・入浴**
- 清拭（全身・部分）
- 全身入浴
- 部分浴（手・足）
- 洗髪
- 洗面
- 整容
- 口腔ケア

**身体整容**
- 爪切り（手・足）
- 更衣介助

**移乗・移動**
- 移乗介助
- 移動介助
- 外出介助
- 体位変換

**起床・就寝**
- 起床介助
- 就寝介助

**服薬・医療行為**
- 服薬介助
- 軟膏・湿布・目薬
- 痰吸引

**自立支援**
- 共に行う調理
- 安全の見守り
- 共に行う家事
- 意欲・関心の引き出し

**生活援助**
- 清掃（居宅・トイレ・卓上）
- ゴミ出し
- 準備・後片付け
- 洗濯・乾燥
- 取り入れ・収納
- アイロン掛け
- 寝具の手入れ（シーツ交換・カバー交換・ベッドメイク・布団干し）
- 衣類の整理・補修
- 調理・配下膳・後片付け
- 買い物（日常品・薬の受取り）

**退出確認**
- 火元チェック
- 電気チェック
- 水道チェック
- 戸締まりチェック

#### 3.3.3 追加項目
- 特記・連絡事項
- 預り金管理
- 利用者捺印欄

## 4. 画面仕様

### 4.1 表側（通常記録アプリ）

#### 4.1.1 メイン画面
- ダッシュボード（本日の予定一覧）
- ナビゲーションメニュー
- 隠しボタン（裏側切り替え用）

#### 4.1.2 予定管理画面
- 予定作成フォーム
- 予定一覧（カレンダービュー）
- 予定詳細・編集

#### 4.1.3 記録入力画面
- 基本情報入力
- サービス内容チェックリスト
- 特記事項入力
- 保存・キャンセルボタン

#### 4.1.4 記録一覧画面
- 記録検索・フィルタリング
- 記録詳細表示
- 印刷機能
  - **個別印刷**: 実時間で印刷日時を記録
  - **一括印刷**: 裏機能として実装、16-18時の範囲で印刷日時を設定
  - **裏機能アクセス**: 記録一覧タイトルを5回クリックで一括印刷ボタンを表示

### 4.2 裏側（CSV一括処理）

#### 4.2.1 CSV一括インポート画面
- ファイルアップロード
- データプレビュー
- パターン選択
- 記録作成時間設定
- 実行・キャンセルボタン

#### 4.2.2 パターン管理画面
- パターン一覧
- パターン作成・編集
- パターンのインポート/エクスポート

## 5. システム要件

### 5.1 技術要件
- フロントエンド：React + TypeScript
- UI：Tailwind CSS
- データベース：Supabase
- 状態管理：React hooks
- ファイル処理：CSV parser
- 認証：Supabase Auth

### 5.2 非機能要件
- レスポンシブデザイン対応
- データの整合性保証
- セキュリティ（認証・認可）
- パフォーマンス（大量データ処理対応）

## 6. データベース設計

### 6.1 テーブル構成

#### 6.1.1 users（利用者）
- id（主キー）
- name（氏名）
- name_kana（氏名カナ）
- user_code（利用者コード）
- care_level（要介護度）
- insurance_number（保険者番号）
- created_at, updated_at

#### 6.1.2 staff（職員）
- id（主キー）
- name（氏名）
- staff_code（職員コード）
- email（メールアドレス）
- is_service_manager（サービス提供責任者フラグ）
- created_at, updated_at

#### 6.1.3 service_schedules（サービス予定）
- id（主キー）
- user_id（利用者ID）
- staff_id（担当職員ID）
- service_date（サービス日）
- start_time（開始時間）
- end_time（終了時間）
- service_type（サービス種類）
- service_content（サービス内容）
- created_at, updated_at

#### 6.1.4 service_records（サービス実施記録）
- id（主キー）
- schedule_id（予定ID）
- user_id（利用者ID）
- staff_id（担当職員ID）
- service_date（実施日）
- start_time（開始時間）
- end_time（終了時間）
- record_created_at（記録作成時間）
- service_details（JSON：詳細チェック項目）
- special_notes（特記事項）
- deposit_amount（預り金）
- created_at, updated_at

#### 6.1.5 service_patterns（サービスパターン）
- id（主キー）
- pattern_name（パターン名）
- pattern_details（JSON：チェック項目）
- description（説明）
- created_at, updated_at

#### 6.1.6 csv_import_logs（CSVインポートログ）
- id（主キー）
- filename（ファイル名）
- import_count（インポート件数）
- success_count（成功件数）
- error_count（エラー件数）
- import_user_id（インポート実行者）
- created_at

## 7. セキュリティ要件

### 7.1 認証・認可
- ユーザー認証（メール＋パスワード）
- 役割ベースのアクセス制御
- セッション管理

### 7.2 データ保護
- Row Level Security（RLS）適用
- 個人情報の暗号化
- アクセスログの記録

## 8. 運用要件

### 8.1 バックアップ
- 日次自動バックアップ
- データエクスポート機能

### 8.2 監査
- 操作ログの記録
- データ変更履歴の追跡

## 9. 開発スケジュール

### Phase 1: 基本機能開発（2週間）
- データベース設計・構築
- 基本認証機能
- 個別記録入力機能

### Phase 2: CSV一括処理機能（1週間）
- CSVパーサー実装
- パターンマッチング機能
- 記録時間ランダム化機能

### Phase 3: パターン管理・UI改善（1週間）
- パターン管理画面
- UI/UX改善
- レスポンシブ対応

### Phase 4: テスト・調整（1週間）
- 統合テスト
- パフォーマンスチューニング
- 本番環境デプロイ

## 10. 制約事項

### 10.1 技術制約
- WebContainer環境での動作
- ブラウザベースの実行
- Supabaseデータベース使用

### 10.2 運用制約
- CSVファイルサイズ上限：10MB
- 同時インポート実行数制限
- データ保持期間：3年間

## 11. リスク管理

### 11.1 データリスク
- CSVデータの不整合対応
- 大量データ処理時のメモリ管理
- 重複データの防止

### 11.2 運用リスク
- ユーザー誤操作の防止
- システム障害時の復旧手順
- データ流出防止策

## 12. 今後の拡張予定

### 12.1 機能拡張
- レポート機能
- 統計分析機能
- モバイルアプリ対応

### 12.2 システム拡張
- API連携機能
- 他システムとの連携
- クラウド連携強化